---
title: "KIND Shiny intro - session 01"
author: "Brendan Clarke"
format: 
    revealjs:
        logo: "KLN_banner_v04_700.png"
        css: logo.css
scrollable: true
smaller: true
execute: 
    echo: true
    eval: false
---

## About this course
+ An accessible introduction to Shiny
+ Interactive
  + Cameras on as much as possible, please
+ Collaborative, particularly for troubleshooting
+ Assumes basic familiarity with R and Posit/Rstudio

## Set-up
Please make a new empty project in Posit

### Helpful resources
+ [Shiny Cheatsheet](https://shiny.rstudio.com/images/shiny-cheatsheet.pdf)
+ [Mastering Shiny](https://mastering-shiny.org/index.html)

## This session
+ basic functions
+ R vs Shiny
+ reactive programming
+ milestones
  + app.R
  + hello world
  + displaying R output
  + adding interactivity
  + first reactivity
  
## What's Shiny?

* R package for interactive, web-based, app development

* Health and social care examples
  + [PHS ScotPHO](https://scotland.shinyapps.io/ScotPHO_profiles_tool/)
  + [NTI dashboard](https://scotland.shinyapps.io/nhs-prescribing-nti/)
  
* Quick demo: `shiny_intro_s01_demo.R`

## Milestone 01
```{r}
#| echo: true
#| eval: false
#| file: ../milestones/shiny_intro_s01_ms_01.R
```

## Shiny vs R (1)

::: {.callout-warning}

The syntax used in Shiny is very similar to R. But the programming approach is totally different.

:::

R is usually **imperative** - "do the following things in this order..."

Shiny is **declarative** - "here are our goals and constraints..." 

> With imperative code you say “Make me a sandwich”. With declarative code you say “Ensure there is a sandwich in the refrigerator whenever I look inside of it”. Imperative code is assertive; declarative code is passive-aggressive.

[Mastering Shiny ch. 3](https://mastering-shiny.org/basic-reactivity.html#imperative-vs-declarative-programming)

## What can you do with Shiny?
* Share code for local use
* Publish apps:
  * Open SaaS platform: https://www.shinyapps.io/
  * Dedicated platforms via Shiny server, SPACe Analytical Workbench...

::: {.callout-tip}

### An excellent primer on deploying Shiny

[Rstudio Shiny tutorial](https://shiny.rstudio.com/tutorial/written-tutorial/lesson7/)

:::

## Milestone 02
```{r}
#| echo: true
#| eval: false
#| file: ../milestones/shiny_intro_s01_ms_02.R
```

![](..//images//image-2077227059.png){fig-align="center"}

## Milestone 03
```{r}
#| echo: true
#| eval: false
#| file: ../milestones/shiny_intro_s01_ms_03.R
```

Note the `output$message` - this is how we pass the body of the message to the `textOutput` part of the UI

## Anatomy of a Shiny app

1. UI
2. Server
3. Call to `shinyApp`

One file or several?

## Shiny vs R (2)
+ reactive
+ interactive
+ UI and server parts
  + `input$x` and `output$x` syntax
  + pairs of functions to pass things (graphs, text) between server and UI 

## Milestone 04
```{r}
#| echo: true
#| eval: false
#| file: ../milestones/shiny_intro_s01_ms_04.R
```

+ `renderText` to pass the output of the standard R code lines 10-12 to `output$mean_att`
+ `textOutput("mean_att")` to insert that output in the UI. 
+ `container=span` keeps text inline

## Add a graph

Let's now add a second pair of functions:

+ add `plotOutput()` to the UI (separated from the `textOutput()` by a comma)
  + add `"att_period"` inside `plotOutput()`
+ add `renderPlot()` to the server, assigned to `output$att_period`

## Code snippet inside the `renderPlot()`

```{r}
ae_attendances %>%
      group_by(period) %>%
      summarise(attendances = sum(attendances)) %>%
      ggplot(aes(x = period, y = attendances)) +
      geom_line() +
      geom_smooth()
```

## Milestone 05
```{r}
#| echo: true
#| eval: false
#| file: ../milestones/shiny_intro_s01_ms_05.R
```

+ That gives us a graph. Can you now try adding a data table, using `dataTableOutput()` and `renderDataTable()`?

## Milestone 06
```{r}
#| echo: true
#| eval: false
#| file: ../milestones/shiny_intro_s01_ms_06.R
```

This is all very static. Let's try to add some interactivity...

## Milestone 07
```{r}
#| echo: true
#| eval: false
#| file: ../milestones/shiny_intro_s01_ms_07.R
```

+ vector of orgs
+ added `radioButtons()` to the `ui()`
+ replaced org codes in the `server()` with `input$org_code`
  
 <!-- all milestones included -->
